<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Emotion Analyzer - Gemini API</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* Modern Sports Broadcast Style - "Emotion Scoreboard" Theme */
        :root {
            --color-dark-bg: #FFF7F2;      /* ì „ì²´ ë°°ê²½ â€“ ë°ì€ í¬ë¦¼ìƒ‰ */
            --color-card-bg: #FFFFFF;      /* ì¹´ë“œ â€“ ìˆœë°±ìƒ‰ */
            --color-accent-blue: #FF8BA7;  /* í¬ì¸íŠ¸ â€“ ë§ë‘í•œ í•‘í¬ */
            --color-text-light: #333333;   /* ê¸°ë³¸ ê¸€ì â€“ ì§„í•œ íšŒìƒ‰ */
            --color-text-secondary: #888888;
            --color-success: #7BC89A;      /* ë¯¸ì…˜ ê°•ì¡° â€“ ì—°í•œ ê·¸ë¦° */
            --color-error: #FF6978;        /* ê²½ê³  â€“ ì‚´êµ¬í•‘í¬ */
            --color-soft-yellow: #FFE8A3;   /* ë²„íŠ¼ìš© ì—°ë…¸ë‘ */
            --color-soft-yellow-hover: #FFD66B;
            --font-main: "Pretendard", "Roboto", system-ui, -apple-system, "Segoe UI", sans-serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: var(--font-main);
        }

        body {
            background-color: var(--color-dark-bg);
            color: var(--color-text-light);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 40px 16px;
        }

        .container {
            width: 100%;
            max-width: 920px;
            padding: 28px;
            background: rgba(255,255,255,0.55);
            border: 1px solid rgba(255,139,167,0.35);
            box-shadow: 0 18px 50px rgba(0,0,0,0.10);
            border-radius: 18px;
            backdrop-filter: blur(6px);
        }

        h1 {
            text-align: center;
            color: var(--color-accent-blue);
            font-size: 2.1em;
            font-weight: 800;
            letter-spacing: -0.02em;
            margin-bottom: 22px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255,139,167,0.65);
        }

        section {
            background-color: var(--color-card-bg);
            padding: 18px 20px;
            margin-bottom: 18px;
            border-radius: 16px;
            box-shadow: 0 10px 24px rgba(0,0,0,0.06);
            border: 1px solid rgba(0,0,0,0.05);
        }

        h2 {
            color: #222;
            margin-bottom: 14px;
            font-size: 1.35em;
            font-weight: 700;
            border-bottom: 1px dashed rgba(0,0,0,0.15);
            padding-bottom: 8px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--color-text-secondary);
        }

        textarea {
            width: 100%;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid var(--color-accent-blue);
            border-radius: 10px;
            background-color: #FFFFFF;
            color: #222222;
            resize: vertical;
            min-height: 150px;
            font-size: 1em;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: var(--color-success);
            box-shadow: 0 0 8px rgba(77, 255, 185, 0.5);
        }

        .emotion-selection {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .emotion-btn {
            background: #fff;
            border: 1px solid rgba(0,0,0,0.12);
            color: #222;
            padding: 10px 14px;
            font-size: 1.05em;
            border-radius: 999px;
            display: flex;
            gap: 8px;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .emotion-btn:hover {
            border-color: rgba(255,139,167,0.7);
            transform: translateY(-1px);
        }

        .emotion-btn.selected {
            border-color: var(--color-accent-blue);
            background: rgba(255,139,167,0.12);
            box-shadow: 0 8px 18px rgba(255,139,167,0.22);
            transform: translateY(-1px);
            font-weight: bold;
        }

        .control-buttons {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            padding: 10px;
            background-color: var(--color-card-bg);
            border-top: 2px solid var(--color-accent-blue);
            margin-top: 20px;
            border-radius: 0 0 12px 12px;
        }

        button {
            padding: 12px 18px;
            font-size: 1.05em;
            font-weight: 700;
            border: none;
            border-radius: 14px;
            cursor: pointer;
            transition: transform 0.15s, box-shadow 0.2s, background-color 0.2s;
        }

        .btn-start {
            background-color: var(--color-accent-blue);
            color: #fff;
            box-shadow: 0 12px 24px rgba(255,139,167,0.28);
        }

        .btn-start:hover {
            transform: translateY(-2px);
        }

        .btn-reset, .btn-history {
            background-color: var(--color-soft-yellow);
            color: #5a4a00;
            box-shadow: 0 10px 22px rgba(255,214,107,0.25);
        }

        .btn-reset:hover, .btn-history:hover {
            background-color: var(--color-soft-yellow-hover);
            transform: translateY(-2px);
        }

        /* --- Result Area --- */
        #result-area {
            display: none;
            flex-direction: column;
            gap: 20px;
        }

        .analysis-box {
            background-color: #FFFFFF;
            padding: 15px;
            border-radius: 12px;
            border: 1px solid #EDEDED;
        }

        .analysis-box h3 {
            font-size: 1.2em;
            color: var(--color-accent-blue);
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .summary-display {
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
            display: block;
            margin-top: 5px;
        }

        .emotion-tag {
            display: inline-block;
            font-size: 1.5em;
            margin-right: 10px;
        }

        #mission-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .mission-item {
            background-color: var(--color-card-bg);
            padding: 15px;
            border-radius: 5px;
            border-left: 5px solid var(--color-success);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        /* Loading Spinner */
        .loading-spinner {
            border: 4px solid var(--color-card-bg);
            border-top: 4px solid var(--color-accent-blue);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
            display: none;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* History */
        #history-section { display: none; }
        #history-view { display: flex; flex-direction: column; gap: 15px; }
        
        .history-entry {
            background-color: #FFFFFF;
            padding: 15px;
            border-radius: 12px;
            border-left: 3px solid var(--color-accent-blue);
            border: 1px solid #EFEFEF;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Gemini Daily Emotion Scoreboard</h1>
        
        <div id="status-result-area">
            
            <section id="input-section">
                <h2>ğŸ“ Today's Report</h2>
                <form id="daily-report-form">
                    <label for="daily-log">ì˜¤ëŠ˜ ìˆì—ˆë˜ ì¼ (Today's Log)</label>
                    <textarea id="daily-log" placeholder="ì˜¤ëŠ˜ í•˜ë£¨ ìˆì—ˆë˜ ì¼, ëŠë‚€ ê°ì • ë“±ì„ ììœ ë¡­ê²Œ ì ì–´ì£¼ì„¸ìš”." required></textarea>

                    <label>ì˜¤ëŠ˜ ê¸°ë¶„ ì„ íƒ (Select Emotion)</label>
                    <div class="emotion-selection">
                        <button type="button" class="emotion-btn" data-emotion="ğŸ˜Š">ğŸ˜Š í–‰ë³µ</button>
                        <button type="button" class="emotion-btn" data-emotion="ğŸ˜¢">ğŸ˜¢ ìŠ¬í””</button>
                        <button type="button" class="emotion-btn" data-emotion="ğŸ˜¡">ğŸ˜¡ ë¶„ë…¸</button>
                        <button type="button" class="emotion-btn" data-emotion="ğŸ˜°">ğŸ˜° ë¶ˆì•ˆ</button>
                        <button type="button" class="emotion-btn" data-emotion="ğŸ˜´">ğŸ˜´ í”¼ê³¤</button>
                    </div>
                </form>
            </section>

            <div class="loading-spinner" id="loading-indicator"></div>

            <section id="result-area">
                <h2>âœ… Gemini Analysis Result</h2>

                <div class="analysis-box">
                    <h3>ì˜¤ëŠ˜ì˜ ê°ì • ìš”ì•½</h3>
                    <div id="result-emotion-container">
                        </div>
                </div>

                <div class="analysis-box">
                    <h3>ì£¼ìš” ê³ ë¯¼/ì£¼ì œ</h3>
                    <p id="result-topic" style="font-size: 1.1em; color: #444;"></p>
                </div>

                <div class="analysis-box">
                    <h3>ë‚´ì¼ì„ ìœ„í•œ ë¯¸ì…˜</h3>
                    <ul id="mission-list">
                        </ul>
                </div>
            </section>

            <section id="history-section">
                <h2>â±ï¸ Past Records</h2>
                <div id="history-view"></div>
            </section>

        </div>
        
        <div class="control-buttons">
            <button class="btn-history" onclick="toggleHistoryView()">
                <span id="history-btn-text">ì§€ë‚œ ê¸°ë¡ ë³´ê¸°</span>
            </button>
            <button class="btn-reset" onclick="resetApp()">ì´ˆê¸°í™”</button>
            <button class="btn-start" onclick="register()" id="start-analysis-btn">âœ¨ Gemini ë¶„ì„ í˜¸ì¶œ</button>
        </div>

    </div>

    <script>
        // âœ… êµìˆ˜ë‹˜ì˜ Replit ì£¼ì†Œ (ë’¤ì— ë¹—ê¸ˆì´ë‚˜ :8000 ì—†ìŒ)
        const SERVER_URL = "https://e37e563b-0b2a-4497-9338-611d4a6118d7-00-1unbj00beh2mg.pike.replit.dev";

        const dailyLogInput = document.getElementById('daily-log');
        const emotionButtons = document.querySelectorAll('.emotion-btn');
        const resultArea = document.getElementById('result-area');
        const historySection = document.getElementById('history-section');
        const historyView = document.getElementById('history-view');
        const historyBtn = document.getElementById('history-btn-text');
        const startAnalysisBtn = document.getElementById('start-analysis-btn');
        const loadingIndicator = document.getElementById('loading-indicator');
        
        let selectedEmotion = null;

        emotionButtons.forEach(button => {
            button.addEventListener('click', () => {
                emotionButtons.forEach(btn => btn.classList.remove('selected'));
                button.classList.add('selected');
                selectedEmotion = button.getAttribute('data-emotion');
            });
        });

        async function register() {
            const dailyLog = dailyLogInput.value.trim();
            const dateKey = new Date().toISOString().split('T')[0];

            if (!dailyLog || !selectedEmotion) {
                alert('ğŸš¨ ì˜¤ëŠ˜ ìˆì—ˆë˜ ì¼ê³¼ ê¸°ë¶„ì„ ëª¨ë‘ ì„ íƒí•´ ì£¼ì„¸ìš”.');
                return;
            }

            startAnalysisBtn.disabled = true;
            startAnalysisBtn.textContent = 'ë¶„ì„ ì¤‘...';
            loadingIndicator.style.display = 'block';
            resultArea.style.display = 'none';

            const payload = {
                date: dateKey,
                log: dailyLog,
                emotion: selectedEmotion
            };
            
            console.log('Sending payload:', payload);

            try {
                // 1. ì„œë²„ í†µì‹ 
                const response = await fetch(`${SERVER_URL}/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload) 
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                // 2. ê²°ê³¼ ë°ì´í„° ë°›ê¸°
                const result = await response.json();
                console.log("ì„œë²„ ì‘ë‹µ:", result);
                
                // 3. í™”ë©´ ì—…ë°ì´íŠ¸ (ì—¬ê¸°ì„œ ì—ëŸ¬ê°€ ë‚˜ì§€ ì•Šë„ë¡ ìˆ˜ì •í•¨)
                updateResultArea(result);
                saveRecord(payload, result);

            } catch (error) {
                console.error('ì—ëŸ¬ ë°œìƒ:', error);
                alert("ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. (ì„ì‹œ ë°ì´í„°ê°€ í‘œì‹œë©ë‹ˆë‹¤)");
                
                // ì—ëŸ¬ ì‹œ ê°€ì§œ ë°ì´í„° ë³´ì—¬ì£¼ê¸°
                const mockResult = generateMockResult(dailyLog, selectedEmotion);
                updateResultArea(mockResult);
            } finally {
                startAnalysisBtn.disabled = false;
                startAnalysisBtn.textContent = 'âœ¨ Gemini ë¶„ì„ í˜¸ì¶œ';
                loadingIndicator.style.display = 'none';
                resultArea.style.display = 'flex';
                
                // ì…ë ¥ì°½ ì´ˆê¸°í™”ëŠ” ì‚¬ìš©ì í¸ì˜ë¥¼ ìœ„í•´ ì£¼ì„ ì²˜ë¦¬ (ì›í•˜ì‹œë©´ ì£¼ì„ í•´ì œ)
                // dailyLogInput.value = '';
            }
        }

        // âœ… [ìˆ˜ì • 3] ì—ëŸ¬(null)ê°€ ì ˆëŒ€ ë‚˜ì§€ ì•ŠëŠ” ì•ˆì „í•œ ë°©ì‹ì˜ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateResultArea(result) {
            // 1. ê°ì • ë° ìš”ì•½ ë°•ìŠ¤ (í†µì§¸ë¡œ êµì²´)
            const emotionContainer = document.getElementById('result-emotion-container');
            if (emotionContainer) {
                emotionContainer.innerHTML = `
                    <div style="display: flex; align-items: center; margin-bottom: 5px;">
                        <span class="emotion-tag">${result.emotionTag}</span>
                        <span style="font-size: 1.2em; font-weight: bold; color: #7BC89A;">${result.summary}</span>
                    </div>
                    <div style="font-size: 1em; color: #555; line-height: 1.4;">
                        "${result.oneLineSummary}"
                    </div>
                `;
            }

            // 2. í•µì‹¬ ì£¼ì œ
            const topicElement = document.getElementById('result-topic');
            if (topicElement) {
                topicElement.textContent = result.keyTopic;
            }
            
            // 3. ë¯¸ì…˜ ë¦¬ìŠ¤íŠ¸
            const missionList = document.getElementById('mission-list');
            if (missionList) {
                missionList.innerHTML = '';
                // ë°°ì—´ì¸ì§€ í™•ì¸ í›„ ì²˜ë¦¬ (ì•ˆì „ì¥ì¹˜)
                const missions = Array.isArray(result.missions) ? result.missions : ["ë¯¸ì…˜ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤."];
                
                missions.forEach(mission => {
                    const li = document.createElement('li');
                    li.className = 'mission-item';
                    li.textContent = mission;
                    missionList.appendChild(li);
                });
            }
        }
        
        function saveRecord(input, result) {
            const records = JSON.parse(localStorage.getItem('dailyRecords') || '{}');
            const newRecord = {
                input: input,
                result: result,
                timestamp: new Date().toLocaleString()
            };
            records[input.date] = newRecord;
            localStorage.setItem('dailyRecords', JSON.stringify(records));
        }
        
        function toggleHistoryView() {
            const isHidden = historySection.style.display === 'none' || historySection.style.display === '';
            if (isHidden) {
                loadHistory();
                historySection.style.display = 'block';
                document.getElementById('input-section').style.display = 'none';
                resultArea.style.display = 'none';
                historyBtn.textContent = 'ê¸°ë¡ ìˆ¨ê¸°ê¸°';
            } else {
                historySection.style.display = 'none';
                document.getElementById('input-section').style.display = 'block';
                if (resultArea.innerHTML.trim() !== "") {
                    resultArea.style.display = 'flex';
                }
                historyBtn.textContent = 'ì§€ë‚œ ê¸°ë¡ ë³´ê¸°';
            }
        }

        function loadHistory() {
            const records = JSON.parse(localStorage.getItem('dailyRecords') || '{}');
            const dates = Object.keys(records).sort().reverse();
            historyView.innerHTML = '';

            if (dates.length === 0) {
                historyView.innerHTML = '<p style="text-align: center; color: #888;">ì €ì¥ëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            dates.forEach(date => {
                const record = records[date];
                const entry = document.createElement('div');
                entry.className = 'history-entry';
                entry.innerHTML = `
                    <strong>ğŸ—“ï¸ ${date} (${record.input.emotion})</strong>
                    <p style="margin-bottom: 5px; font-weight: bold;">${record.result.summary}</p>
                    <p style="font-size: 0.9em; color: #666;">${record.result.oneLineSummary}</p>
                    <details style="margin-top: 8px;">
                        <summary style="cursor: pointer; color: #7BC89A;">ìƒì„¸ ë³´ê¸°</summary>
                        <p style="margin-top:5px;"><strong>ì›ë¬¸:</strong> ${record.input.log}</p>
                        <p><strong>ë¯¸ì…˜:</strong> ${record.result.missions.join(' | ')}</p>
                    </details>
                `;
                historyView.appendChild(entry);
            });
        }

        function resetApp() {
            if (confirm('ëª¨ë“  ì…ë ¥ í•„ë“œë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                dailyLogInput.value = '';
                emotionButtons.forEach(btn => btn.classList.remove('selected'));
                selectedEmotion = null;
                resultArea.style.display = 'none';
                if (historySection.style.display !== 'none') {
                     toggleHistoryView();
                }
            }
        }

        function generateMockResult(log, emotion) {
            return {
                emotionTag: emotion,
                summary: "ë¶„ì„ì„ ì™„ë£Œí•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤",
                oneLineSummary: "ì„œë²„ì™€ì˜ ì—°ê²° ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”. (ì„ì‹œ ë©”ì‹œì§€)",
                keyTopic: "ì—°ê²° ì˜¤ë¥˜",
                missions: ["ë„¤íŠ¸ì›Œí¬ í™•ì¸í•˜ê¸°", "ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ê¸°", "ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ê¸°"]
            };
        }
    </script>

</body>
</html>

